<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3f7;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: var(--dark-color);
            transition: all 0.3s ease;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: var(--primary-color);
            color: white;
            position: fixed;
            height: 100vh;
            padding: 20px 0;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h3 {
            margin: 0;
        }

        .close-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }

        .sidebar-menu li {
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .sidebar-menu li:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu li i {
            margin-right: 10px;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .sidebar-overlay.open {
            display: block;
        }

        /* Navbar Styles */
        .navbar {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-left {
            display: flex;
            align-items: center;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            margin-right: 15px;
            cursor: pointer;
            color: var(--dark-color);
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo i {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-right: 10px;
        }

        .logo h1 {
            font-size: 1.5rem;
            margin: 0;
            color: var(--dark-color);
        }

        .navbar-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .btn i {
            font-size: 1rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 20px;
            margin-left: 0;
            transition: margin-left 0.3s;
        }

        .main-content.expanded {
            margin-left: 250px;
        }

        /* Page Styles */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Form Styles */
        .expense-form {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .form-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(79, 195, 247, 0.25);
        }

        .radio-group {
            display: flex;
            gap: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .radio-option input {
            margin: 0;
        }

        .btn-submit {
            background-color: var(--success-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
        }

        .btn-submit:hover {
            background-color: #218838;
        }

        /* Table Styles */
        .expense-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .expense-table th, .expense-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .expense-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }

        .expense-table tr:hover {
            background-color: #f9f9f9;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .edit-btn {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .rename-btn {
            background-color: var(--info-color);
            color: white;
        }

        /* Summary Styles */
        .summary {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .summary-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-item {
            padding: 10px;
            border-radius: 4px;
            background-color: #f8f9fa;
        }

        .summary-item h4 {
            margin-bottom: 5px;
            color: var(--dark-color);
            font-size: 1rem;
        }

        .summary-item p {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Custom Table Builder Styles */
        .custom-builder {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .column-list {
            margin-bottom: 20px;
        }

        .column-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .column-actions {
            display: flex;
            gap: 5px;
        }

        .input-type-selector {
            min-width: 150px;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr 1fr;
            }

            .navbar-buttons {
                flex-direction: column;
                gap: 5px;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .expense-table {
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 576px) {
            .summary-grid {
                grid-template-columns: 1fr;
            }

            .logo h1 {
                font-size: 1.2rem;
            }

            .navbar {
                flex-direction: column;
                align-items: flex-start;
            }

            .navbar-left {
                width: 100%;
                justify-content: space-between;
                margin-bottom: 10px;
            }

            .navbar-buttons {
                width: 100%;
            }
        }
        .icon{
              height: 24px;
    padding: 1px;
    margin: 2px;
    border-radius: 6px;
    margin-right: 2px;
    display: flex
;
    justify-content: center;
    align-self: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Menu</h3>
                <button class="close-sidebar" id="closeSidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul class="sidebar-menu">
                <li id="homeLink">
                    <i class="fas fa-home"></i> Home
                </li>
                <li id="historyLink">
                    <i class="fas fa-history"></i> History
                </li>
                <li id="filesLink">
                    <i class="fas fa-folder"></i> Your Files
                </li>
                <li id="customLink">
                    <i class="fas fa-cogs"></i> Custom Section
                </li>
            </ul>
        </div>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Navbar -->
            <nav class="navbar">
                <div class="navbar-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="logo">
                        <img class="icon" src="Expense-Tracker-Icon-6.png">
                        <h1>Expense Tracker</h1>
                    </div>
                </div>
                <div class="navbar-buttons">
                    <button class="btn btn-primary" id="downloadExcel">
                        <i class="fas fa-file-excel"></i> Download Excel
                    </button>
                    <button class="btn btn-success" id="exportGoogleSheet">
                        <i class="fab fa-google-drive"></i> Export to Google Sheet
                    </button>
                    <button class="btn btn-warning" id="newFileBtn">
                        <i class="fas fa-file"></i> New File
                    </button>
                </div>
            </nav>

            <!-- Home Page -->
            <div class="page active" id="homePage">
                <!-- Expense Form -->
                <div class="expense-form">
                    <h2 class="form-title">Add New Expense</h2>
                    <form id="expenseForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="date">Date</label>
                                <input type="date" id="date" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="from">From</label>
                                <input type="text" id="from" class="form-control" placeholder="Departure location" required>
                            </div>
                            <div class="form-group">
                                <label for="to">To</label>
                                <input type="text" id="to" class="form-control" placeholder="Destination" required>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="travellingCost">Travelling Cost</label>
                                <input type="text" id="travellingCost" class="form-control" placeholder="e.g., 100+50+30">
                            </div>
                            <div class="form-group">
                                <label>Ticket</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="ticket" value="Available"> Available
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="ticket" value="Not Available" checked> Not Available
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="travellingClaim">Travelling Claim</label>
                                <input type="text" id="travellingClaim" class="form-control" placeholder="e.g., 100+50+30">
                            </div>
                            <div class="form-group">
                                <label>Ticket Claim</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="ticketClaim" value="Available"> Available
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="ticketClaim" value="Not Available" checked> Not Available
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="da">DA</label>
                                <input type="text" id="da" class="form-control" placeholder="e.g., Breakfast➝50+Lunch➝120">
                            </div>
                            <div class="form-group">
                                <label>DA Receipt</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="daReceipt" value="Available"> Available
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="daReceipt" value="Not Available" checked> Not Available
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="daClaim">DA Claim</label>
                                <input type="text" id="daClaim" class="form-control" placeholder="e.g., 100+50+30">
                            </div>
                            <div class="form-group">
                                <label>Stay</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="stay" id="stayYes" value="Yes"> Yes
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="stay" id="stayNo" value="No" checked> No
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group" id="stayChargeGroup" style="display: none;">
                            <label for="stayCharge">Stay Charge</label>
                            <input type="number" id="stayCharge" class="form-control" placeholder="Enter charge amount">
                        </div>

                        <div class="form-group">
                            <label>DA Claim Receipt</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="daClaimReceipt" value="Available"> Available
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="daClaimReceipt" value="Not Available" checked> Not Available
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="btn-submit">Add Expense</button>
                    </form>
                </div>

                <!-- Expense Table -->
                <div class="table-responsive">
                    <table class="expense-table" id="expenseTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Destination</th>
                                <th>Travelling Cost</th>
                                <th>Travelling Claim</th>
                                <th>DA</th>
                                <th>DA Claim</th>
                                <th>Total Claim</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="expenseTableBody">
                            <!-- Table rows will be added here dynamically -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="2"><strong>Subtotal</strong></td>
                                <td id="subtotalTravellingCost">0</td>
                                <td id="subtotalTravellingClaim">0</td>
                                <td id="subtotalDA">0</td>
                                <td id="subtotalDAClaim">0</td>
                                <td id="subtotalTotalClaim">0</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <!-- Summary Section -->
                <div class="summary">
                    <h2 class="summary-title">Expense Summary</h2>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <h4>Total Days</h4>
                            <p id="totalDays">0</p>
                        </div>
                        <div class="summary-item">
                            <h4>Total Travelling Cost</h4>
                            <p id="totalTravellingCost">0</p>
                        </div>
                        <div class="summary-item">
                            <h4>Total Travelling Claim</h4>
                            <p id="totalTravellingClaim">0</p>
                        </div>
                        <div class="summary-item">
                            <h4>Total DA</h4>
                            <p id="totalDA">0</p>
                        </div>
                        <div class="summary-item">
                            <h4>Total DA Claim</h4>
                            <p id="totalDAClaim">0</p>
                        </div>
                        <div class="summary-item">
                            <h4>Total Claim</h4>
                            <p id="totalClaim">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Page -->
            <div class="page" id="historyPage">
                <div class="expense-form">
                    <h2 class="form-title">Recent Files</h2>
                    <ul id="historyList" style="list-style: none; padding: 0;">
                        <!-- History items will be added here dynamically -->
                    </ul>
                </div>
            </div>

            <!-- Files Page -->
            <div class="page" id="filesPage">
                <div class="expense-form">
                    <h2 class="form-title">Your Files</h2>
                    <div id="noFilesMessage" style="text-align: center; padding: 20px; display: none;">
                        <p>No files saved yet.</p>
                    </div>
                    <table class="expense-table" id="filesTable" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="filesTableBody">
                            <!-- Files will be added here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Custom Page -->
            <div class="page" id="customPage">
                <div class="custom-builder">
                    <h2 class="form-title">Custom Table Builder</h2>
                    <div class="form-group">
                        <label for="customTableName">Table Name</label>
                        <input type="text" id="customTableName" class="form-control" placeholder="Enter table name">
                    </div>
                    
                    <div class="form-group">
                        <label>Add Columns</label>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="columnName">Column Name</label>
                                <input type="text" id="columnName" class="form-control" placeholder="Column name">
                            </div>
                            <div class="form-group">
                                <label for="columnType">Input Type</label>
                                <select id="columnType" class="form-control input-type-selector">
                                    <option value="text">Text</option>
                                    <option value="number">Number</option>
                                    <option value="date">Date</option>
                                    <option value="checkbox">Checkbox</option>
                                    <option value="radio">Radio</option>
                                    <option value="select">Dropdown</option>
                                </select>
                            </div>
                            <div class="form-group" id="optionsGroup" style="display: none;">
                                <label for="columnOptions">Options (comma separated)</label>
                                <input type="text" id="columnOptions" class="form-control" placeholder="Option1, Option2, Option3">
                            </div>
                        </div>
                        <button class="btn btn-primary" id="addColumnBtn">Add Column</button>
                    </div>
                    
                    <div class="column-list" id="columnList">
                        <!-- Columns will be added here -->
                    </div>
                    
                    <button class="btn btn-success" id="createCustomTableBtn">Create Table</button>
                </div>
                
                <div id="customTableContainer" style="display: none;">
                    <div class="expense-form">
                        <h2 class="form-title" id="customTableTitle">Custom Table</h2>
                        <form id="customTableForm">
                            <!-- Form fields will be added dynamically -->
                        </form>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="expense-table" id="customTable">
                            <thead id="customTableHead">
                                <!-- Headers will be added dynamically -->
                            </thead>
                            <tbody id="customTableBody">
                                <!-- Rows will be added dynamically -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="navbar-buttons" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="downloadCustomExcel">
                            <i class="fas fa-file-excel"></i> Download Excel
                        </button>
                        <button class="btn btn-warning" id="saveCustomFileBtn">
                            <i class="fas fa-save"></i> Save Custom File
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Save File Modal -->
    <div class="modal" id="saveFileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Save Current File</h3>
                <button class="close-modal" id="closeSaveModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="fileName">File Name</label>
                    <input type="text" id="fileName" class="form-control" placeholder="Enter file name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancelSave">Cancel</button>
                <button class="btn btn-success" id="confirmSave">Save</button>
            </div>
        </div>
    </div>

    <!-- Edit File Modal -->
    <div class="modal" id="editFileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit File</h3>
                <button class="close-modal" id="closeEditModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editFileName">File Name</label>
                    <input type="text" id="editFileName" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancelEdit">Cancel</button>
                <button class="btn btn-success" id="confirmEdit">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            const closeSidebar = document.getElementById('closeSidebar');
            const mainContent = document.getElementById('mainContent');
            const expenseForm = document.getElementById('expenseForm');
            const expenseTableBody = document.getElementById('expenseTableBody');
            const downloadExcelBtn = document.getElementById('downloadExcel');
            const exportGoogleSheetBtn = document.getElementById('exportGoogleSheet');
            const newFileBtn = document.getElementById('newFileBtn');
            const saveFileModal = document.getElementById('saveFileModal');
            const closeSaveModal = document.getElementById('closeSaveModal');
            const cancelSave = document.getElementById('cancelSave');
            const confirmSave = document.getElementById('confirmSave');
            const fileNameInput = document.getElementById('fileName');
            const homeLink = document.getElementById('homeLink');
            const historyLink = document.getElementById('historyLink');
            const filesLink = document.getElementById('filesLink');
            const customLink = document.getElementById('customLink');
            const homePage = document.getElementById('homePage');
            const historyPage = document.getElementById('historyPage');
            const filesPage = document.getElementById('filesPage');
            const customPage = document.getElementById('customPage');
            const historyList = document.getElementById('historyList');
            const filesTableBody = document.getElementById('filesTableBody');
            const noFilesMessage = document.getElementById('noFilesMessage');
            const editFileModal = document.getElementById('editFileModal');
            const closeEditModal = document.getElementById('closeEditModal');
            const cancelEdit = document.getElementById('cancelEdit');
            const confirmEdit = document.getElementById('confirmEdit');
            const editFileNameInput = document.getElementById('editFileName');
            const stayYesRadio = document.getElementById('stayYes');
            const stayNoRadio = document.getElementById('stayNo');
            const stayChargeGroup = document.getElementById('stayChargeGroup');
            
            // Custom Page Elements
            const columnNameInput = document.getElementById('columnName');
            const columnTypeSelect = document.getElementById('columnType');
            const optionsGroup = document.getElementById('optionsGroup');
            const columnOptionsInput = document.getElementById('columnOptions');
            const addColumnBtn = document.getElementById('addColumnBtn');
            const columnList = document.getElementById('columnList');
            const customTableNameInput = document.getElementById('customTableName');
            const createCustomTableBtn = document.getElementById('createCustomTableBtn');
            const customTableContainer = document.getElementById('customTableContainer');
            const customTableTitle = document.getElementById('customTableTitle');
            const customTableForm = document.getElementById('customTableForm');
            const customTableHead = document.getElementById('customTableHead');
            const customTableBody = document.getElementById('customTableBody');
            const downloadCustomExcelBtn = document.getElementById('downloadCustomExcel');
            const saveCustomFileBtn = document.getElementById('saveCustomFileBtn');

            // Data
            let expenses = [];
            let currentFile = {
                id: Date.now(),
                name: 'Untitled',
                data: [],
                createdAt: new Date(),
                type: 'expense'
            };
            let files = JSON.parse(localStorage.getItem('expenseFiles')) || [];
            let history = JSON.parse(localStorage.getItem('expenseHistory')) || [];
            let fileToEdit = null;
            
            // Custom Table Data
            let customColumns = [];
            let customTableData = [];
            let currentCustomFile = {
                id: Date.now(),
                name: 'Untitled Custom',
                data: [],
                columns: [],
                createdAt: new Date(),
                type: 'custom'
            };

            // Initialize the app
            function init() {
                // Load the most recent file if available
                if (history.length > 0) {
                    const lastFileId = history[0].id;
                    const lastFile = files.find(file => file.id === lastFileId);
                    if (lastFile) {
                        loadFile(lastFile.id, false);
                    }
                }
                
                // Load pages
                loadPage('home');
            }

            // Sidebar toggle
            menuToggle.addEventListener('click', function() {
                sidebar.classList.add('open');
                sidebarOverlay.classList.add('open');
                mainContent.classList.add('expanded');
            });

            closeSidebar.addEventListener('click', function() {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('open');
                mainContent.classList.remove('expanded');
            });

            sidebarOverlay.addEventListener('click', function() {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('open');
                mainContent.classList.remove('expanded');
            });

            // Navigation
            homeLink.addEventListener('click', function() {
                loadPage('home');
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('open');
                mainContent.classList.remove('expanded');
            });

            historyLink.addEventListener('click', function() {
                loadPage('history');
                renderHistoryList();
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('open');
                mainContent.classList.remove('expanded');
            });

            filesLink.addEventListener('click', function() {
                loadPage('files');
                renderFilesList();
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('open');
                mainContent.classList.remove('expanded');
            });

            customLink.addEventListener('click', function() {
                loadPage('custom');
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('open');
                mainContent.classList.remove('expanded');
            });

            function loadPage(page) {
                // Hide all pages
                document.querySelectorAll('.page').forEach(p => {
                    p.classList.remove('active');
                });
                
                // Show the selected page
                switch(page) {
                    case 'home':
                        homePage.classList.add('active');
                        document.title = 'Expense Tracker - Home';
                        break;
                    case 'history':
                        historyPage.classList.add('active');
                        document.title = 'Expense Tracker - History';
                        break;
                    case 'files':
                        filesPage.classList.add('active');
                        document.title = 'Expense Tracker - Files';
                        break;
                    case 'custom':
                        customPage.classList.add('active');
                        document.title = 'Expense Tracker - Custom';
                        break;
                }
            }

            // Stay charge visibility
            stayYesRadio.addEventListener('change', function() {
                if (this.checked) {
                    stayChargeGroup.style.display = 'block';
                }
            });

            stayNoRadio.addEventListener('change', function() {
                if (this.checked) {
                    stayChargeGroup.style.display = 'none';
                }
            });

            // Form submission
            expenseForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const date = document.getElementById('date').value;
                const from = document.getElementById('from').value;
                const to = document.getElementById('to').value;
                const travellingCost = document.getElementById('travellingCost').value;
                const ticket = document.querySelector('input[name="ticket"]:checked').value;
                const travellingClaim = document.getElementById('travellingClaim').value;
                const ticketClaim = document.querySelector('input[name="ticketClaim"]:checked').value;
                const da = document.getElementById('da').value;
                const daReceipt = document.querySelector('input[name="daReceipt"]:checked').value;
                const daClaim = document.getElementById('daClaim').value;
                const stay = document.querySelector('input[name="stay"]:checked').value;
                const stayCharge = stay === 'Yes' ? document.getElementById('stayCharge').value : 0;
                const daClaimReceipt = document.querySelector('input[name="daClaimReceipt"]:checked').value;
                
                // Format the data for the table
                const destination = `${from} ➝ ${to}`;
                
                let formattedTravellingCost = travellingCost;
                if (ticket === 'Available') {
                    formattedTravellingCost = `Ticket ➝ ${ticket}\n${formattedTravellingCost}`;
                }
                
                let formattedTravellingClaim = travellingClaim;
                if (ticketClaim === 'Available') {
                    formattedTravellingClaim = `Ticket ➝ ${ticketClaim}\n${formattedTravellingClaim}`;
                }
                
                let formattedDA = da;
                if (daReceipt === 'Available') {
                    formattedDA = `Receipt ➝ ${daReceipt}\n${formattedDA}`;
                }
                
                let formattedDAClaim = daClaim;
                if (stay === 'Yes') {
                    formattedDAClaim = `Stay ➝ ${stayCharge}\n${formattedDAClaim}`;
                }
                if (daClaimReceipt === 'Available') {
                    formattedDAClaim = `Receipt ➝ ${daClaimReceipt}\n${formattedDAClaim}`;
                }
                
                // Calculate sums
                const travellingCostSum = calculateSum(travellingCost);
                const travellingClaimSum = calculateSum(travellingClaim);
                const daSum = calculateSum(da.split('+').map(item => {
                    const parts = item.split('➝');
                    return parts.length > 1 ? parts[1].trim() : parts[0].trim();
                }).join('+'));
                let daClaimSum = calculateSum(daClaim);
                if (stay === 'Yes') {
                    daClaimSum += parseFloat(stayCharge) || 0;
                }
                const totalClaim = travellingClaimSum + daClaimSum;
                
                // Create expense object
                const expense = {
                    id: Date.now(),
                    date,
                    destination,
                    travellingCost: formattedTravellingCost,
                    travellingCostSum,
                    travellingClaim: formattedTravellingClaim,
                    travellingClaimSum,
                    da: formattedDA,
                    daSum,
                    daClaim: formattedDAClaim,
                    daClaimSum,
                    totalClaim
                };
                
                // Add to expenses array
                expenses.push(expense);
                
                // Update current file data
                currentFile.data = expenses;
                currentFile.updatedAt = new Date();
                
                // Save to localStorage
                saveCurrentFile();
                
                // Render table
                renderExpenseTable();
                updateSummary();
                
                // Reset form
                expenseForm.reset();
                stayChargeGroup.style.display = 'none';
            });

            // Calculate sum from a string like "100+50+30"
            function calculateSum(valueString) {
                if (!valueString) return 0;
                
                try {
                    // Handle DA format (Breakfast➝50+Lunch➝120)
                    if (valueString.includes('➝')) {
                        const items = valueString.split('+');
                        return items.reduce((sum, item) => {
                            const parts = item.split('➝');
                            const value = parts.length > 1 ? parseFloat(parts[1].trim()) || 0 : parseFloat(parts[0].trim()) || 0;
                            return sum + value;
                        }, 0);
                    } else {
                        // Handle simple format (100+50+30)
                        return valueString.split('+').reduce((sum, val) => {
                            return sum + (parseFloat(val.trim()) || 0);
                        }, 0);
                    }
                } catch (e) {
                    console.error('Error calculating sum:', e);
                    return 0;
                }
            }

            // Render expense table
            function renderExpenseTable() {
                expenseTableBody.innerHTML = '';
                
                if (expenses.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="8" style="text-align: center;">No expenses added yet</td>`;
                    expenseTableBody.appendChild(row);
                    return;
                }
                
                // Group expenses by date and destination for subtotals
                const groupedExpenses = {};
                expenses.forEach(expense => {
                    const key = `${expense.date}_${expense.destination}`;
                    if (!groupedExpenses[key]) {
                        groupedExpenses[key] = [];
                    }
                    groupedExpenses[key].push(expense);
                });
                
                // Render each group with subtotal
                Object.keys(groupedExpenses).forEach((key, groupIndex) => {
                    const group = groupedExpenses[key];
                    const firstExpense = group[0];
                    
                    // Calculate subtotals for the group
                    const subtotalTravellingCost = group.reduce((sum, exp) => sum + exp.travellingCostSum, 0);
                    const subtotalTravellingClaim = group.reduce((sum, exp) => sum + exp.travellingClaimSum, 0);
                    const subtotalDA = group.reduce((sum, exp) => sum + exp.daSum, 0);
                    const subtotalDAClaim = group.reduce((sum, exp) => sum + exp.daClaimSum, 0);
                    const subtotalTotalClaim = group.reduce((sum, exp) => sum + exp.totalClaim, 0);
                    
                    // Render each expense in the group
                    group.forEach((expense, index) => {
                        const row = document.createElement('tr');
                        
                        // Only show date and destination for the first row in the group
                        const dateCell = index === 0 ? `<td rowspan="${group.length}">${expense.date}</td>` : '';
                        const destinationCell = index === 0 ? `<td rowspan="${group.length}">${expense.destination}</td>` : '';
                        
                        row.innerHTML = `
                            ${dateCell}
                            ${destinationCell}
                            <td>${formatMultiline(expense.travellingCost)}<br><strong>${expense.travellingCostSum.toFixed(2)}</strong></td>
                            <td>${formatMultiline(expense.travellingClaim)}<br><strong>${expense.travellingClaimSum.toFixed(2)}</strong></td>
                            <td>${formatMultiline(expense.da)}<br><strong>${expense.daSum.toFixed(2)}</strong></td>
                            <td>${formatMultiline(expense.daClaim)}<br><strong>${expense.daClaimSum.toFixed(2)}</strong></td>
                            <td><strong>${expense.totalClaim.toFixed(2)}</strong></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn edit-btn" data-id="${expense.id}">Edit</button>
                                    <button class="action-btn delete-btn" data-id="${expense.id}">Delete</button>
                                </div>
                            </td>
                        `;
                        
                        expenseTableBody.appendChild(row);
                    });
                    
                    // Add subtotal row after each group (except the last one)
                    if (groupIndex < Object.keys(groupedExpenses).length - 1) {
                        const subtotalRow = document.createElement('tr');
                        subtotalRow.className = 'subtotal-row';
                        subtotalRow.innerHTML = `
                            <td colspan="2"><strong>Subtotal</strong></td>
                            <td><strong>${subtotalTravellingCost.toFixed(2)}</strong></td>
                            <td><strong>${subtotalTravellingClaim.toFixed(2)}</strong></td>
                            <td><strong>${subtotalDA.toFixed(2)}</strong></td>
                            <td><strong>${subtotalDAClaim.toFixed(2)}</strong></td>
                            <td><strong>${subtotalTotalClaim.toFixed(2)}</strong></td>
                            <td></td>
                        `;
                        expenseTableBody.appendChild(subtotalRow);
                    }
                });
                
                // Update the footer subtotals
                updateSubtotals();
                
                // Add event listeners to action buttons
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        editExpense(id);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        deleteExpense(id);
                    });
                });
            }

            // Format multiline text for display
            function formatMultiline(text) {
                if (!text) return '';
                return text.replace(/\n/g, '<br>');
            }

            // Update subtotals in table footer
            function updateSubtotals() {
                const subtotalTravellingCost = expenses.reduce((sum, exp) => sum + exp.travellingCostSum, 0);
                const subtotalTravellingClaim = expenses.reduce((sum, exp) => sum + exp.travellingClaimSum, 0);
                const subtotalDA = expenses.reduce((sum, exp) => sum + exp.daSum, 0);
                const subtotalDAClaim = expenses.reduce((sum, exp) => sum + exp.daClaimSum, 0);
                const subtotalTotalClaim = expenses.reduce((sum, exp) => sum + exp.totalClaim, 0);
                
                document.getElementById('subtotalTravellingCost').textContent = subtotalTravellingCost.toFixed(2);
                document.getElementById('subtotalTravellingClaim').textContent = subtotalTravellingClaim.toFixed(2);
                document.getElementById('subtotalDA').textContent = subtotalDA.toFixed(2);
                document.getElementById('subtotalDAClaim').textContent = subtotalDAClaim.toFixed(2);
                document.getElementById('subtotalTotalClaim').textContent = subtotalTotalClaim.toFixed(2);
            }

            // Update summary section
            function updateSummary() {
                if (expenses.length === 0) {
                    document.getElementById('totalDays').textContent = '0';
                    document.getElementById('totalTravellingCost').textContent = '0';
                    document.getElementById('totalTravellingClaim').textContent = '0';
                    document.getElementById('totalDA').textContent = '0';
                    document.getElementById('totalDAClaim').textContent = '0';
                    document.getElementById('totalClaim').textContent = '0';
                    return;
                }
                
                // Calculate unique days
                const uniqueDays = new Set(expenses.map(exp => exp.date));
                document.getElementById('totalDays').textContent = uniqueDays.size;
                
                // Calculate totals
                const totalTravellingCost = expenses.reduce((sum, exp) => sum + exp.travellingCostSum, 0);
                const totalTravellingClaim = expenses.reduce((sum, exp) => sum + exp.travellingClaimSum, 0);
                const totalDA = expenses.reduce((sum, exp) => sum + exp.daSum, 0);
                const totalDAClaim = expenses.reduce((sum, exp) => sum + exp.daClaimSum, 0);
                const totalClaim = expenses.reduce((sum, exp) => sum + exp.totalClaim, 0);
                
                document.getElementById('totalTravellingCost').textContent = totalTravellingCost.toFixed(2);
                document.getElementById('totalTravellingClaim').textContent = totalTravellingClaim.toFixed(2);
                document.getElementById('totalDA').textContent = totalDA.toFixed(2);
                document.getElementById('totalDAClaim').textContent = totalDAClaim.toFixed(2);
                document.getElementById('totalClaim').textContent = totalClaim.toFixed(2);
            }

            // Edit expense
            function editExpense(id) {
                const expense = expenses.find(exp => exp.id === id);
                if (!expense) return;
                
                // Extract original values from the formatted strings
                const destinationParts = expense.destination.split(' ➝ ');
                const from = destinationParts[0];
                const to = destinationParts[1] || '';
                
                // Extract ticket availability from travellingCost
                let ticket = 'Not Available';
                if (expense.travellingCost.includes('Ticket ➝ Available')) {
                    ticket = 'Available';
                }
                let travellingCost = expense.travellingCost.replace(`Ticket ➝ ${ticket}\n`, '');
                
                // Extract ticket claim availability from travellingClaim
                let ticketClaim = 'Not Available';
                if (expense.travellingClaim.includes('Ticket ➝ Available')) {
                    ticketClaim = 'Available';
                }
                let travellingClaim = expense.travellingClaim.replace(`Ticket ➝ ${ticketClaim}\n`, '');
                
                // Extract DA receipt availability
                let daReceipt = 'Not Available';
                if (expense.da.includes('Receipt ➝ Available')) {
                    daReceipt = 'Available';
                }
                let da = expense.da.replace(`Receipt ➝ ${daReceipt}\n`, '');
                
                // Extract DA claim receipt and stay information
                let daClaimReceipt = 'Not Available';
                let stay = 'No';
                let stayCharge = '0';
                let daClaim = expense.daClaim;
                
                if (daClaim.includes('Receipt ➝ Available')) {
                    daClaimReceipt = 'Available';
                    daClaim = daClaim.replace(`Receipt ➝ ${daClaimReceipt}\n`, '');
                } else if (daClaim.includes('Receipt ➝ Not Available')) {
                    daClaim = daClaim.replace(`Receipt ➝ Not Available\n`, '');
                }
                
                if (daClaim.includes('Stay ➝')) {
                    stay = 'Yes';
                    const stayMatch = daClaim.match(/Stay ➝ (\d+(\.\d+)?)/);
                    if (stayMatch) {
                        stayCharge = stayMatch[1];
                    }
                    daClaim = daClaim.replace(`Stay ➝ ${stayCharge}\n`, '');
                }
                
                // Fill the form with the expense data
                document.getElementById('date').value = expense.date;
                document.getElementById('from').value = from;
                document.getElementById('to').value = to;
                document.getElementById('travellingCost').value = travellingCost;
                document.querySelector(`input[name="ticket"][value="${ticket}"]`).checked = true;
                document.getElementById('travellingClaim').value = travellingClaim;
                document.querySelector(`input[name="ticketClaim"][value="${ticketClaim}"]`).checked = true;
                document.getElementById('da').value = da;
                document.querySelector(`input[name="daReceipt"][value="${daReceipt}"]`).checked = true;
                document.getElementById('daClaim').value = daClaim;
                document.querySelector(`input[name="stay"][value="${stay}"]`).checked = true;
                
                if (stay === 'Yes') {
                    stayChargeGroup.style.display = 'block';
                    document.getElementById('stayCharge').value = stayCharge;
                } else {
                    stayChargeGroup.style.display = 'none';
                }
                
                document.querySelector(`input[name="daClaimReceipt"][value="${daClaimReceipt}"]`).checked = true;
                
                // Remove the expense from the array
                expenses = expenses.filter(exp => exp.id !== id);
                
                // Update current file data
                currentFile.data = expenses;
                currentFile.updatedAt = new Date();
                
                // Save to localStorage
                saveCurrentFile();
                
                // Re-render the table
                renderExpenseTable();
                updateSummary();
            }

            // Delete expense
            function deleteExpense(id) {
                if (confirm('Are you sure you want to delete this expense?')) {
                    expenses = expenses.filter(exp => exp.id !== id);
                    
                    // Update current file data
                    currentFile.data = expenses;
                    currentFile.updatedAt = new Date();
                    
                    // Save to localStorage
                    saveCurrentFile();
                    
                    // Re-render the table
                    renderExpenseTable();
                    updateSummary();
                }
            }

            // Download Excel
            downloadExcelBtn.addEventListener('click', function() {
                if (expenses.length === 0) {
                    alert('No data to export');
                    return;
                }
                
                // Prepare data for Excel
                const excelData = [
                    ['Date', 'Destination', 'Travelling Cost', 'Travelling Claim', 'DA', 'DA Claim', 'Total Claim']
                ];
                
                expenses.forEach(expense => {
                    excelData.push([
                        expense.date,
                        expense.destination,
                        expense.travellingCostSum,
                        expense.travellingClaimSum,
                        expense.daSum,
                        expense.daClaimSum,
                        expense.totalClaim
                    ]);
                });
                
                // Add totals row
                const totalTravellingCost = expenses.reduce((sum, exp) => sum + exp.travellingCostSum, 0);
                const totalTravellingClaim = expenses.reduce((sum, exp) => sum + exp.travellingClaimSum, 0);
                const totalDA = expenses.reduce((sum, exp) => sum + exp.daSum, 0);
                const totalDAClaim = expenses.reduce((sum, exp) => sum + exp.daClaimSum, 0);
                const totalClaim = expenses.reduce((sum, exp) => sum + exp.totalClaim, 0);
                
                excelData.push([
                    'TOTAL',
                    '',
                    totalTravellingCost,
                    totalTravellingClaim,
                    totalDA,
                    totalDAClaim,
                    totalClaim
                ]);
                
                // Create worksheet
                const ws = XLSX.utils.aoa_to_sheet(excelData);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Expenses');
                
                // Generate file and download
                const fileName = `${currentFile.name || 'expenses'}.xlsx`;
                XLSX.writeFile(wb, fileName);
            });

            // Export to Google Sheet (mock implementation)
            exportGoogleSheetBtn.addEventListener('click', function() {
                alert('This would export to Google Sheets in a real implementation. For this demo, you can use the Excel download.');
            });

            // New file button
            newFileBtn.addEventListener('click', function() {
                if (expenses.length > 0) {
                    // Show save file modal
                    saveFileModal.classList.add('open');
                } else {
                    // No data to save, just create a new file
                    createNewFile();
                }
            });

            // Save file modal
            closeSaveModal.addEventListener('click', function() {
                saveFileModal.classList.remove('open');
            });

            cancelSave.addEventListener('click', function() {
                saveFileModal.classList.remove('open');
            });

            confirmSave.addEventListener('click', function() {
                const fileName = fileNameInput.value.trim() || 'Untitled';
                saveCurrentFileAs(fileName);
                saveFileModal.classList.remove('open');
                createNewFile();
            });

            // Save current file with a new name
            function saveCurrentFileAs(fileName) {
                if (expenses.length === 0) return;
                
                const fileId = currentFile.id || Date.now();
                const now = new Date();
                
                const fileToSave = {
                    id: fileId,
                    name: fileName,
                    data: [...expenses],
                    createdAt: currentFile.createdAt || now,
                    updatedAt: now,
                    type: 'expense'
                };
                
                // Check if this file already exists
                const existingFileIndex = files.findIndex(file => file.id === fileId);
                if (existingFileIndex !== -1) {
                    files[existingFileIndex] = fileToSave;
                } else {
                    files.push(fileToSave);
                }
                
                // Add to history
                addToHistory(fileId);
                
                // Save to localStorage
                localStorage.setItem('expenseFiles', JSON.stringify(files));
                localStorage.setItem('expenseHistory', JSON.stringify(history));
                
                // Show success message
                alert(`File "${fileName}" saved successfully!`);
            }

            // Save current file (without changing name)
            function saveCurrentFile() {
                if (!currentFile.id || expenses.length === 0) return;
                
                const now = new Date();
                
                const fileToSave = {
                    ...currentFile,
                    data: [...expenses],
                    updatedAt: now
                };
                
                // Update in files array
                const existingFileIndex = files.findIndex(file => file.id === currentFile.id);
                if (existingFileIndex !== -1) {
                    files[existingFileIndex] = fileToSave;
                } else {
                    files.push(fileToSave);
                }
                
                // Add to history
                addToHistory(currentFile.id);
                
                // Save to localStorage
                localStorage.setItem('expenseFiles', JSON.stringify(files));
                localStorage.setItem('expenseHistory', JSON.stringify(history));
            }

            // Add file to history
            function addToHistory(fileId) {
                // Remove if already in history
                history = history.filter(item => item.id !== fileId);
                
                // Add to beginning of history
                history.unshift({
                    id: fileId,
                    accessedAt: new Date()
                });
                
                // Keep only last 10 items
                if (history.length > 10) {
                    history = history.slice(0, 10);
                }
            }

            // Create a new empty file
            function createNewFile() {
                currentFile = {
                    id: Date.now(),
                    name: 'Untitled',
                    data: [],
                    createdAt: new Date(),
                    type: 'expense'
                };
                
                expenses = [];
                renderExpenseTable();
                updateSummary();
                
                // Clear form
                expenseForm.reset();
                stayChargeGroup.style.display = 'none';
            }

            // Render history list
            function renderHistoryList() {
                historyList.innerHTML = '';
                
                if (history.length === 0) {
                    historyList.innerHTML = '<li>No recent files</li>';
                } else {
                    history.forEach(item => {
                        const file = files.find(f => f.id === item.id);
                        if (file) {
                            const li = document.createElement('li');
                            li.style.padding = '10px';
                            li.style.borderBottom = '1px solid #eee';
                            li.style.cursor = 'pointer';
                            
                            li.innerHTML = `
                                <strong>${file.name}</strong><br>
                                <small>Last accessed: ${new Date(item.accessedAt).toLocaleString()}</small>
                            `;
                            
                            li.addEventListener('click', function() {
                                loadFile(file.id);
                                loadPage('home');
                            });
                            
                            historyList.appendChild(li);
                        }
                    });
                }
            }

            // Render files list
            function renderFilesList() {
                filesTableBody.innerHTML = '';
                
                if (files.length === 0) {
                    noFilesMessage.style.display = 'block';
                    filesTable.style.display = 'none';
                } else {
                    noFilesMessage.style.display = 'none';
                    filesTable.style.display = 'table';
                    
                    files.forEach(file => {
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${file.name}</td>
                            <td>${new Date(file.createdAt).toLocaleDateString()}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn rename-btn" data-id="${file.id}">Rename</button>
                                    <button class="action-btn delete-btn" data-id="${file.id}">Delete</button>
                                    <button class="action-btn load-btn" data-id="${file.id}">Load</button>
                                </div>
                            </td>
                        `;
                        
                        filesTableBody.appendChild(row);
                    });
                    
                    // Add event listeners to action buttons
                    document.querySelectorAll('.rename-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const id = parseInt(this.getAttribute('data-id'));
                            editFile(id);
                        });
                    });
                    
                    document.querySelectorAll('.delete-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const id = parseInt(this.getAttribute('data-id'));
                            deleteFile(id);
                        });
                    });
                    
                    document.querySelectorAll('.load-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const id = parseInt(this.getAttribute('data-id'));
                            loadFile(id);
                            loadPage(file.type === 'custom' ? 'custom' : 'home');
                        });
                    });
                }
            }

            // Edit file name
            function editFile(id) {
                const file = files.find(f => f.id === id);
                if (!file) return;
                
                fileToEdit = file;
                editFileNameInput.value = file.name;
                editFileModal.classList.add('open');
            }

            // Close edit modal
            closeEditModal.addEventListener('click', function() {
                editFileModal.classList.remove('open');
                fileToEdit = null;
            });

            cancelEdit.addEventListener('click', function() {
                editFileModal.classList.remove('open');
                fileToEdit = null;
            });

            // Confirm edit
            confirmEdit.addEventListener('click', function() {
                if (!fileToEdit) return;
                
                const newName = editFileNameInput.value.trim();
                if (!newName) {
                    alert('Please enter a file name');
                    return;
                }
                
                fileToEdit.name = newName;
                fileToEdit.updatedAt = new Date();
                
                // Update in files array
                const index = files.findIndex(f => f.id === fileToEdit.id);
                if (index !== -1) {
                    files[index] = fileToEdit;
                }
                
                // Save to localStorage
                localStorage.setItem('expenseFiles', JSON.stringify(files));
                
                // If this is the current file, update the current file reference
                if (currentFile.id === fileToEdit.id) {
                    currentFile.name = newName;
                }
                
                // Close modal and refresh files list
                editFileModal.classList.remove('open');
                fileToEdit = null;
                renderFilesList();
            });

            // Delete file
            function deleteFile(id) {
                if (confirm('Are you sure you want to delete this file? This cannot be undone.')) {
                    // Remove from files array
                    files = files.filter(f => f.id !== id);
                    
                    // Remove from history
                    history = history.filter(item => item.id !== id);
                    
                    // If this is the current file, create a new empty file
                    if (currentFile.id === id) {
                        createNewFile();
                    }
                    
                    // Save to localStorage
                    localStorage.setItem('expenseFiles', JSON.stringify(files));
                    localStorage.setItem('expenseHistory', JSON.stringify(history));
                    
                    // Refresh files list
                    renderFilesList();
                }
            }

            // Load file
            function loadFile(id, showAlert = true) {
                const file = files.find(f => f.id === id);
                if (!file) return;
                
                if (file.type === 'expense') {
                    currentFile = file;
                    expenses = file.data;
                    
                    // Render the data
                    renderExpenseTable();
                    updateSummary();
                } else if (file.type === 'custom') {
                    currentCustomFile = file;
                    customColumns = file.columns;
                    customTableData = file.data;
                    
                    // Render the custom table
                    renderCustomTableForm();
                    renderCustomTable();
                }
                
                // Add to history
                addToHistory(file.id);
                localStorage.setItem('expenseHistory', JSON.stringify(history));
                
                // Show success message
                if (showAlert) {
                    alert(`File "${file.name}" loaded successfully!`);
                }
            }

            // Custom Table Builder Functionality
            columnTypeSelect.addEventListener('change', function() {
                const selectedType = this.value;
                if (selectedType === 'radio' || selectedType === 'select' || selectedType === 'checkbox') {
                    optionsGroup.style.display = 'block';
                } else {
                    optionsGroup.style.display = 'none';
                }
            });

            addColumnBtn.addEventListener('click', function() {
                const name = columnNameInput.value.trim();
                const type = columnTypeSelect.value;
                
                if (!name) {
                    alert('Please enter a column name');
                    return;
                }
                
                const column = {
                    id: Date.now(),
                    name,
                    type,
                    options: type === 'radio' || type === 'select' || type === 'checkbox' ? 
                        columnOptionsInput.value.split(',').map(opt => opt.trim()) : []
                };
                
                customColumns.push(column);
                renderColumnList();
                
                // Clear inputs
                columnNameInput.value = '';
                columnOptionsInput.value = '';
                optionsGroup.style.display = 'none';
                columnTypeSelect.value = 'text';
            });

            function renderColumnList() {
                columnList.innerHTML = '';
                
                customColumns.forEach((column, index) => {
                    const columnItem = document.createElement('div');
                    columnItem.className = 'column-item';
                    
                    columnItem.innerHTML = `
                        <span><strong>${column.name}</strong> (${column.type})</span>
                        <div class="column-actions">
                            <button class="action-btn delete-btn" data-index="${index}">Delete</button>
                        </div>
                    `;
                    
                    columnList.appendChild(columnItem);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.column-item .delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        customColumns.splice(index, 1);
                        renderColumnList();
                    });
                });
            }

            createCustomTableBtn.addEventListener('click', function() {
                const tableName = customTableNameInput.value.trim();
                
                if (!tableName) {
                    alert('Please enter a table name');
                    return;
                }
                
                if (customColumns.length === 0) {
                    alert('Please add at least one column');
                    return;
                }
                
                currentCustomFile.name = tableName;
                customTableTitle.textContent = tableName;
                
                // Render the form and table
                renderCustomTableForm();
                renderCustomTable();
                
                // Show the table container
                customTableContainer.style.display = 'block';
            });

            function renderCustomTableForm() {
                customTableForm.innerHTML = '';
                
                customColumns.forEach(column => {
                    const formGroup = document.createElement('div');
                    formGroup.className = 'form-group';
                    
                    const label = document.createElement('label');
                    label.textContent = column.name;
                    label.htmlFor = `custom-${column.id}`;
                    
                    let input;
                    
                    switch(column.type) {
                        case 'text':
                        case 'number':
                        case 'date':
                            input = document.createElement('input');
                            input.type = column.type;
                            input.id = `custom-${column.id}`;
                            input.className = 'form-control';
                            break;
                        case 'checkbox':
                            input = document.createElement('div');
                            column.options.forEach(option => {
                                const checkboxDiv = document.createElement('div');
                                const checkbox = document.createElement('input');
                                checkbox.type = 'checkbox';
                                checkbox.id = `custom-${column.id}-${option.replace(/\s+/g, '-')}`;
                                checkbox.name = `custom-${column.id}`;
                                checkbox.value = option;
                                
                                const checkboxLabel = document.createElement('label');
                                checkboxLabel.htmlFor = `custom-${column.id}-${option.replace(/\s+/g, '-')}`;
                                checkboxLabel.textContent = option;
                                
                                checkboxDiv.appendChild(checkbox);
                                checkboxDiv.appendChild(checkboxLabel);
                                input.appendChild(checkboxDiv);
                            });
                            break;
                        case 'radio':
                            input = document.createElement('div');
                            column.options.forEach(option => {
                                const radioDiv = document.createElement('div');
                                const radio = document.createElement('input');
                                radio.type = 'radio';
                                radio.id = `custom-${column.id}-${option.replace(/\s+/g, '-')}`;
                                radio.name = `custom-${column.id}`;
                                radio.value = option;
                                
                                const radioLabel = document.createElement('label');
                                radioLabel.htmlFor = `custom-${column.id}-${option.replace(/\s+/g, '-')}`;
                                radioLabel.textContent = option;
                                
                                radioDiv.appendChild(radio);
                                radioDiv.appendChild(radioLabel);
                                input.appendChild(radioDiv);
                            });
                            break;
                        case 'select':
                            input = document.createElement('select');
                            input.id = `custom-${column.id}`;
                            input.className = 'form-control';
                            column.options.forEach(option => {
                                const optionEl = document.createElement('option');
                                optionEl.value = option;
                                optionEl.textContent = option;
                                input.appendChild(optionEl);
                            });
                            break;
                    }
                    
                    formGroup.appendChild(label);
                    formGroup.appendChild(input);
                    customTableForm.appendChild(formGroup);
                });
                
                const submitBtn = document.createElement('button');
                submitBtn.type = 'button';
                submitBtn.className = 'btn-submit';
                submitBtn.textContent = 'Add Row';
                submitBtn.addEventListener('click', addCustomRow);
                
                customTableForm.appendChild(submitBtn);
            }

            function addCustomRow() {
                const rowData = {};
                
                customColumns.forEach(column => {
                    const input = document.getElementById(`custom-${column.id}`);
                    
                    switch(column.type) {
                        case 'text':
                        case 'number':
                        case 'date':
                        case 'select':
                            rowData[column.id] = input.value;
                            break;
                        case 'checkbox':
                            const checkboxes = document.querySelectorAll(`input[name="custom-${column.id}"]:checked`);
                            rowData[column.id] = Array.from(checkboxes).map(cb => cb.value).join(', ');
                            break;
                        case 'radio':
                            const radio = document.querySelector(`input[name="custom-${column.id}"]:checked`);
                            rowData[column.id] = radio ? radio.value : '';
                            break;
                    }
                    
                    // Clear the input
                    if (column.type !== 'radio' && column.type !== 'checkbox') {
                        input.value = '';
                    } else if (column.type === 'checkbox') {
                        document.querySelectorAll(`input[name="custom-${column.id}"]`).forEach(cb => {
                            cb.checked = false;
                        });
                    }
                });
                
                rowData.id = Date.now();
                customTableData.push(rowData);
                
                // Update current custom file data
                currentCustomFile.data = customTableData;
                currentCustomFile.columns = customColumns;
                currentCustomFile.updatedAt = new Date();
                
                // Save to localStorage
                saveCustomFile();
                
                // Re-render the table
                renderCustomTable();
            }

            function renderCustomTable() {
                customTableHead.innerHTML = '';
                customTableBody.innerHTML = '';
                
                // Create header row
                const headerRow = document.createElement('tr');
                
                customColumns.forEach(column => {
                    const th = document.createElement('th');
                    th.textContent = column.name;
                    headerRow.appendChild(th);
                });
                
                // Add actions header
                const actionsTh = document.createElement('th');
                actionsTh.textContent = 'Actions';
                headerRow.appendChild(actionsTh);
                
                customTableHead.appendChild(headerRow);
                
                // Create data rows
                if (customTableData.length === 0) {
                    const emptyRow = document.createElement('tr');
                    const emptyCell = document.createElement('td');
                    emptyCell.colSpan = customColumns.length + 1;
                    emptyCell.textContent = 'No data added yet';
                    emptyCell.style.textAlign = 'center';
                    emptyRow.appendChild(emptyCell);
                    customTableBody.appendChild(emptyRow);
                } else {
                    customTableData.forEach(row => {
                        const tr = document.createElement('tr');
                        
                        customColumns.forEach(column => {
                            const td = document.createElement('td');
                            td.textContent = row[column.id] || '';
                            tr.appendChild(td);
                        });
                        
                        // Add actions cell
                        const actionsTd = document.createElement('td');
                        actionsTd.innerHTML = `
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-id="${row.id}">Edit</button>
                                <button class="action-btn delete-btn" data-id="${row.id}">Delete</button>
                            </div>
                        `;
                        tr.appendChild(actionsTd);
                        
                        customTableBody.appendChild(tr);
                    });
                }
                
                // Add event listeners to action buttons
                document.querySelectorAll('#customTable .edit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        editCustomRow(id);
                    });
                });
                
                document.querySelectorAll('#customTable .delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        deleteCustomRow(id);
                    });
                });
            }

            function editCustomRow(id) {
                const row = customTableData.find(r => r.id === id);
                if (!row) return;
                
                // Fill the form with the row data
                customColumns.forEach(column => {
                    const input = document.getElementById(`custom-${column.id}`);
                    
                    switch(column.type) {
                        case 'text':
                        case 'number':
                        case 'date':
                        case 'select':
                            if (input) input.value = row[column.id] || '';
                            break;
                        case 'checkbox':
                            const values = row[column.id] ? row[column.id].split(', ') : [];
                            document.querySelectorAll(`input[name="custom-${column.id}"]`).forEach(cb => {
                                cb.checked = values.includes(cb.value);
                            });
                            break;
                        case 'radio':
                            document.querySelector(`input[name="custom-${column.id}"][value="${row[column.id]}"]`).checked = true;
                            break;
                    }
                });
                
                // Remove the row from the array
                customTableData = customTableData.filter(r => r.id !== id);
                
                // Update current custom file data
                currentCustomFile.data = customTableData;
                currentCustomFile.updatedAt = new Date();
                
                // Save to localStorage
                saveCustomFile();
                
                // Re-render the table
                renderCustomTable();
            }

            function deleteCustomRow(id) {
                if (confirm('Are you sure you want to delete this row?')) {
                    customTableData = customTableData.filter(r => r.id !== id);
                    
                    // Update current custom file data
                    currentCustomFile.data = customTableData;
                    currentCustomFile.updatedAt = new Date();
                    
                    // Save to localStorage
                    saveCustomFile();
                    
                    // Re-render the table
                    renderCustomTable();
                }
            }

            function saveCustomFile() {
                if (!currentCustomFile.id) return;
                
                const now = new Date();
                
                const fileToSave = {
                    ...currentCustomFile,
                    data: [...customTableData],
                    columns: [...customColumns],
                    updatedAt: now
                };
                
                // Check if this file already exists
                const existingFileIndex = files.findIndex(file => file.id === currentCustomFile.id);
                if (existingFileIndex !== -1) {
                    files[existingFileIndex] = fileToSave;
                } else {
                    files.push(fileToSave);
                }
                
                // Add to history
                addToHistory(currentCustomFile.id);
                
                // Save to localStorage
                localStorage.setItem('expenseFiles', JSON.stringify(files));
                localStorage.setItem('expenseHistory', JSON.stringify(history));
            }

            downloadCustomExcelBtn.addEventListener('click', function() {
                if (customTableData.length === 0) {
                    alert('No data to export');
                    return;
                }
                
                // Prepare data for Excel
                const excelData = [
                    customColumns.map(col => col.name)
                ];
                
                customTableData.forEach(row => {
                    const rowData = customColumns.map(col => row[col.id] || '');
                    excelData.push(rowData);
                });
                
                // Create worksheet
                const ws = XLSX.utils.aoa_to_sheet(excelData);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, currentCustomFile.name);
                
                // Generate file and download
                const fileName = `${currentCustomFile.name || 'custom_data'}.xlsx`;
                XLSX.writeFile(wb, fileName);
            });

            saveCustomFileBtn.addEventListener('click', function() {
                if (customTableData.length === 0) {
                    alert('No data to save');
                    return;
                }
                
                const fileName = prompt('Enter a name for your custom file:', currentCustomFile.name);
                
                if (fileName) {
                    currentCustomFile.name = fileName;
                    saveCustomFile();
                    alert(`File "${fileName}" saved successfully!`);
                }
            });

            // Initialize the app
            init();
        });
    </script>
</body>
</html>