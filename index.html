<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily Travel Expense Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <style>
    :root {
      --bg: #ffffff;
      --text: #000000;
      --input-bg: #f0f0f0;
      --table-bg: #ffffff;
    }
    body.dark {
      --bg: #1e1e1e;
      --text: #f0f0f0;
      --input-bg: #333333;
      --table-bg: #2b2b2b;
    }

    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 20px;
    }

    input, button {
      padding: 8px;
      margin: 5px;
      background: var(--input-bg);
      color: var(--text);
      border: 1px solid #ccc;
    }

    #tableContainer {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
      border: 1px solid #ccc;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
      background: var(--table-bg);
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    .summary {
      margin-top: 15px;
      font-weight: bold;
    }

    .no-data {
      text-align: center;
      padding: 20px;
      color: gray;
    }

    .theme-toggle {
      float: right;
      margin-bottom: 10px;
    }

    @media print {
      form, button, .summary, .theme-toggle, #fileInput {
        display: none;
      }
      #tableContainer {
        max-height: none;
        overflow: visible;
      }
    }
  </style>
</head>
<body>

  <h2>Daily Travel Expense Tracker
    <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
  </h2>

  <form id="expenseForm">
    <input type="date" id="date" required>
    <input type="text" id="from" placeholder="From" required>
    <input type="text" id="to" placeholder="To" required>
    <input type="number" id="travel" placeholder="Travelling Cost (‚Çπ)" required>
    <input type="number" id="da" placeholder="DA (‚Çπ)" required>
    <input type="number" id="daClaim" placeholder="DA Claim (‚Çπ)" required>
    <button type="submit">Add Entry</button>
    <button type="button" onclick="exportToExcel()">Download Excel</button>
    <button type="button" onclick="exportToJSON()">Save File</button>
    <input type="file" id="fileInput" accept=".json" onchange="importFromJSON()">
    <button type="button" onclick="sendToGoogleSheets()">Send to Google Sheet</button>
    <button type="button" onclick="window.print()">Print</button>
  </form>

  <div id="tableContainer">
    <table id="expenseTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>From ‚ûù To</th>
          <th>Travelling Cost (‚Çπ)</th>
          <th>DA (‚Çπ)</th>
          <th>DA Claim (‚Çπ)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="noData" class="no-data">No data yet</div>
  </div>

  <div class="summary" id="totals">
    Total Travelling Cost: ‚Çπ0 | Total DA: ‚Çπ0 | Total DA Claim: ‚Çπ0
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const form = document.getElementById('expenseForm');
    const tableBody = document.querySelector('#expenseTable tbody');
    const noDataMsg = document.getElementById('noData');
    const totalsDisplay = document.getElementById('totals');
    let entries = [];

    function toggleTheme() {
      document.body.classList.toggle("dark");
      localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
    }

    function loadTheme() {
      if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark");
      }
    }

    loadTheme();

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      addEntry();
    });

    function addEntry(entry = null, index = null) {
      const date = entry ? entry[0] : document.getElementById('date').value;
      const from = entry ? entry[1] : document.getElementById('from').value;
      const to = entry ? entry[2] : document.getElementById('to').value;
      const travel = entry ? entry[3] : parseFloat(document.getElementById('travel').value);
      const da = entry ? entry[4] : parseFloat(document.getElementById('da').value);
      const daClaim = entry ? entry[5] : parseFloat(document.getElementById('daClaim').value);

      if (!date || !from || !to || isNaN(travel) || isNaN(da) || isNaN(daClaim)) return;

      const newRow = [date, from, to, travel, da, daClaim];

      if (index !== null) {
        entries[index] = newRow;
      } else {
        entries.push(newRow);
      }

      renderTable();
      form.reset();
    }

    function renderTable() {
      tableBody.innerHTML = "";
      if (entries.length === 0) {
        noDataMsg.style.display = "block";
      } else {
        noDataMsg.style.display = "none";
        entries.forEach((row, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${row[0]}</td>
            <td>${row[1]} ‚ûù ${row[2]}</td>
            <td>${row[3].toFixed(2)}</td>
            <td>${row[4].toFixed(2)}</td>
            <td>${row[5].toFixed(2)}</td>
            <td>
              <button onclick="editRow(${idx})">Edit</button>
              <button onclick="deleteRow(${idx})">Delete</button>
            </td>
          `;
          tableBody.appendChild(tr);
        });
      }
      updateTotals();
    }

    function editRow(index) {
      const row = entries[index];
      document.getElementById('date').value = row[0];
      document.getElementById('from').value = row[1];
      document.getElementById('to').value = row[2];
      document.getElementById('travel').value = row[3];
      document.getElementById('da').value = row[4];
      document.getElementById('daClaim').value = row[5];
      entries.splice(index, 1);
      renderTable();
    }

    function deleteRow(index) {
      if (confirm("Are you sure you want to delete this entry?")) {
        entries.splice(index, 1);
        renderTable();
      }
    }

    function updateTotals() {
      const totalTravel = entries.reduce((sum, row) => sum + row[3], 0);
      const totalDA = entries.reduce((sum, row) => sum + row[4], 0);
      const totalDAClaim = entries.reduce((sum, row) => sum + row[5], 0);
      totalsDisplay.innerText = `Total Travelling Cost: ‚Çπ${totalTravel.toFixed(2)} | Total DA: ‚Çπ${totalDA.toFixed(2)} | Total DA Claim: ‚Çπ${totalDAClaim.toFixed(2)}`;
    }

    function exportToExcel() {
      const headers = ["Date", "From", "To", "Travelling Cost (‚Çπ)", "DA (‚Çπ)", "DA Claim (‚Çπ)"];
      const ws = XLSX.utils.aoa_to_sheet([headers, ...entries]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Expenses");
      XLSX.writeFile(wb, "TravelExpenses.xlsx");
    }

    function exportToJSON() {
      const blob = new Blob([JSON.stringify(entries)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "TravelExpenses.json";
      a.click();
    }

    function importFromJSON() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const importedData = JSON.parse(e.target.result);
          if (Array.isArray(importedData)) {
            entries = importedData;
            renderTable();
          } else {
            alert("Invalid file format.");
          }
        } catch (err) {
          alert("Error reading file.");
        }
      };
      reader.readAsText(file);
    }

    function sendToGoogleSheets() {
      const sheetURL = "YOUR_GOOGLE_APPS_SCRIPT_WEBAPP_URL"; // Replace this!
      fetch(sheetURL, {
        method: "POST",
        body: JSON.stringify(entries),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.text())
      .then(msg => alert("Data sent to Google Sheet successfully!"))
      .catch(err => alert("Failed to send: " + err.message));
    }
  </script>

</body>
</html>
